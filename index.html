<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tim Schubert</title>
  <meta name="description" content="Tim Schubert - MD/PhD Student. Researcher." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  <style>
    :root {
      --bg-light: #fafafa;
      --bg-black: #0a0a0a;
      --text-light: #0a0a0a;
      --text-on-dark: #e5e5e5;
      --muted: #737373;
      --border: #0a0a0a;
      --dev: #0ea5e9;
      --deg: #10b981;
      --ml: #f59e0b;
      --edge: #0a0a0a;
      /* Research: unified blue palette (cards + graph) */
      --theme-1: #7dd3fc;
      --theme-2: #0ea5e9;
      --theme-3: #0369a1;
      --theme-1-tint: rgba(125, 211, 252, 0.18);
      --theme-2-tint: rgba(14, 165, 233, 0.18);
      --theme-3-tint: rgba(3, 105, 161, 0.25);
      --graph-edge: rgba(148, 163, 184, 0.5);
    }

    * { box-sizing: border-box; }
    html {
      scroll-behavior: smooth;
      scroll-snap-type: y proximity;
    }
    html, body { margin: 0; padding: 0; font-family: 'Rubik', system-ui, sans-serif; }

    /* ----- Hero ----- */
    .hero {
      min-height: 100vh;
      scroll-snap-align: start;
      scroll-snap-stop: always;
      background: var(--bg-black);
      color: var(--text-on-dark);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 2rem 1.5rem 4rem;
      position: relative;
    }
    .hero-photo {
      width: clamp(140px, 28vw, 220px);
      height: clamp(140px, 28vw, 220px);
      border-radius: 50%;
      object-fit: cover;
      display: block;
      margin-bottom: 2rem;
    }
    .hero-typewriter {
      font-size: clamp(1rem, 2.2vw, 1.35rem);
      font-weight: 400;
      text-align: center;
      max-width: 42ch;
      margin: 0 auto 2rem;
      min-height: 2.6em;
      line-height: 1.5;
    }
    .hero-typewriter .cursor {
      display: inline-block;
      width: 2px;
      height: 1.1em;
      background: currentColor;
      margin-left: 2px;
      vertical-align: text-bottom;
      animation: blink 0.8s step-end infinite;
    }
    @keyframes blink { 50% { opacity: 0; } }
    .hero-social {
      display: flex;
      gap: 1rem;
      margin-bottom: 3rem;
    }
    .hero-social a {
      color: var(--text-on-dark);
      padding: 0.5rem;
      border-radius: 50%;
      transition: opacity 0.2s, transform 0.2s;
    }
    .hero-social a:hover {
      opacity: 0.8;
      transform: translateY(-2px);
    }
    .hero-social svg { width: 22px; height: 22px; display: block; }
    .section-arrow {
      position: absolute;
      bottom: 1.5rem;
      left: 50%;
      transform: translateX(-50%);
      color: var(--text-on-dark);
      opacity: 0.7;
      text-decoration: none;
      transition: opacity 0.2s, transform 0.2s;
    }
    .section-arrow:hover { opacity: 1; transform: translateX(-50%) translateY(4px); }
    .section-arrow svg { width: 28px; height: 28px; display: block; }
    .hero-arrow.arrow-bounce { animation: arrow-bounce 0.6s ease-out; }
    @keyframes arrow-bounce {
      0%, 100% { transform: translateX(-50%) translateY(0); }
      50% { transform: translateX(-50%) translateY(10px); }
    }

    /* ----- Chips below About headline ----- */
    .chips-float {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.5rem;
      margin: 0 0 1.25rem;
      padding: 0 1rem;
    }
    .chip {
      background: var(--bg-black);
      color: var(--text-on-dark);
      padding: 0.4rem 0.9rem;
      border-radius: 999px;
      font-size: 0.8rem;
      font-weight: 500;
    }

    /* ----- Section common ----- */
    section {
      min-height: 100vh;
      scroll-snap-align: start;
      scroll-snap-stop: always;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 4rem 1.5rem 5rem;
      position: relative;
    }
    section.light {
      background: var(--bg-light);
      color: var(--text-light);
    }
    section.dark {
      background: var(--bg-black);
      color: var(--text-on-dark);
    }
    .section-inner {
      max-width: 680px;
      width: 100%;
      margin: 0 auto;
    }
    section h2 {
      font-size: clamp(1.5rem, 3vw, 1.75rem);
      font-weight: 700;
      margin: 0 0 1.25rem;
      text-align: center;
    }

    /* ----- About ----- */
    #about .section-inner { text-align: center; }
    #about p {
      margin: 0 0 1rem;
      line-height: 1.65;
      color: var(--text-light);
    }
    #about .btn-message {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      margin-top: 1.25rem;
      padding: 0.6rem 1.1rem;
      background: var(--bg-black);
      color: var(--text-on-dark);
      border-radius: 999px;
      font-weight: 600;
      font-size: 0.95rem;
      text-decoration: none;
      transition: opacity 0.2s, transform 0.2s;
    }
    #about .btn-message:hover { opacity: 0.9; transform: translateY(-1px); }
    /* ----- Projects (Currently working on) ----- */
    #now ul {
      list-style: none;
      margin: 0 0 1.5rem;
      padding: 0;
    }
    #now .item {
      padding: 0.6rem 0;
      border-bottom: 1px solid rgba(0,0,0,0.08);
      line-height: 1.5;
      font-size: 0.95rem;
    }
    #now .item:last-child { border-bottom: 0; }
    #now .item b { font-weight: 600; }
    .floating-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.75rem;
      margin-top: 1.5rem;
    }
    .floating-buttons a {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.55rem 1rem;
      background: var(--bg-black);
      color: var(--text-on-dark);
      border: 1px solid var(--border);
      border-radius: 999px;
      font-size: 0.85rem;
      font-weight: 500;
      text-decoration: none;
      transition: opacity 0.2s, transform 0.2s;
    }
    .floating-buttons a:hover {
      opacity: 0.9;
      transform: translateY(-2px);
    }
    .floating-buttons .ico { width: 16px; height: 16px; flex-shrink: 0; }
    @media (max-width: 768px) {
      .floating-buttons {
        flex-direction: column;
        align-items: stretch;
      }
    }

    /* ----- Research (dark section) ----- */
    #research { padding: 3rem 1.5rem 4rem; }
    #research .section-intro {
      text-align: center;
      font-size: 0.85rem;
      line-height: 1.5;
      color: rgba(255,255,255,0.75);
      margin: 0 0 1rem;
      max-width: 36rem;
      margin-left: auto;
      margin-right: auto;
    }
    #research .section-actions {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.5rem;
      margin: 1rem 0 0;
    }
    #research .section-actions a {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.5rem 0.9rem;
      background: #fff;
      color: #0a0a0a;
      border: 1px solid #0a0a0a;
      border-radius: 999px;
      font-size: 0.85rem;
      font-weight: 500;
      text-decoration: none;
      transition: opacity 0.2s, transform 0.2s;
    }
    #research .section-actions a:hover { opacity: 0.9; transform: translateY(-1px); }
    #research .section-actions .ico { width: 16px; height: 16px; }
    .themes {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1.5rem 2rem;
      margin-bottom: 1rem;
    }
    .theme-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .theme-dot-wrap {
      position: relative;
      display: inline-flex;
      flex-shrink: 0;
      cursor: help;
    }
    .theme-dot {
      width: 26px;
      height: 26px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.85rem;
      font-weight: 600;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .theme-dot-wrap:hover .theme-dot {
      transform: scale(1.08);
      box-shadow: 0 0 0 2px rgba(255,255,255,0.3);
    }
    .theme-item:nth-child(1) .theme-dot { background: var(--theme-1); color: rgba(0,0,0,0.65); }
    .theme-item:nth-child(2) .theme-dot { background: var(--theme-2); color: rgba(255,255,255,0.95); }
    .theme-item:nth-child(3) .theme-dot { background: var(--theme-3); color: rgba(255,255,255,0.95); }
    .theme-name {
      font-size: 0.9rem;
      font-weight: 500;
      color: var(--text-on-dark);
    }
    .theme-questions {
      position: absolute;
      bottom: calc(100% + 10px);
      left: 50%;
      transform: translateX(-50%) scale(0);
      transform-origin: 50% 100%;
      padding: 0.85rem 1rem;
      font-size: 0.78rem;
      line-height: 1.5;
      color: rgba(255,255,255,0.95);
      background: rgba(0,0,0,0.9);
      border-radius: 50%;
      width: 260px;
      height: 260px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      pointer-events: none;
      opacity: 0;
      visibility: hidden;
      transition: transform 0.25s ease-out, opacity 0.2s, visibility 0.2s;
      z-index: 5;
    }
    .theme-questions p {
      margin: 0 0 0.5em;
      max-width: 220px;
    }
    .theme-questions p:last-child { margin-bottom: 0; }
    .theme-dot-wrap:hover .theme-questions {
      transform: translateX(-50%) scale(1);
      opacity: 1;
      visibility: visible;
    }
    .theme-questions.flip-below {
      top: calc(100% + 10px);
      bottom: auto;
      transform-origin: 50% 0%;
    }
    .theme-dot-wrap:hover .theme-questions.flip-below {
      transform: translateX(-50%) scale(1);
    }
    @media (max-width: 768px) {
      .theme-questions {
        position: fixed;
        left: 50%;
        top: 50%;
        bottom: auto;
        width: min(260px, calc(100vw - 2rem));
        height: min(260px, calc(100vw - 2rem));
        transform: translate(-50%, -50%) scale(0);
        transform-origin: 50% 50%;
        z-index: 20;
      }
      .theme-dot-wrap:hover .theme-questions {
        transform: translate(-50%, -50%) scale(1);
      }
    }
    .graphCard {
      position: relative;
      overflow: hidden;
      margin-bottom: 0.75rem;
    }
    #graphsvg { width: 100%; height: 320px; display: block; overflow: hidden; }
    @media (max-width: 820px) { #graphsvg { height: 220px; } }
    .paper-tooltip {
      position: fixed;
      pointer-events: none;
      cursor: pointer;
      background: #fff;
      border-radius: 12px;
      padding: 0.75rem 1rem;
      max-width: 320px;
      z-index: 10;
      display: none;
      box-shadow: 0 10px 40px rgba(0,0,0,0.12), 0 2px 8px rgba(0,0,0,0.06);
      border: 1px solid rgba(0,0,0,0.06);
      font-size: 0.85rem;
      line-height: 1.4;
    }
    .paper-tooltip .tooltip-theme {
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      color: var(--muted);
      margin-bottom: 0.35rem;
    }
    .paper-tooltip .tooltip-title {
      font-weight: 500;
      color: var(--text-light);
      margin: 0;
    }
    .paper-tooltip .tooltip-hint {
      font-size: 0.75rem;
      color: var(--muted);
      margin-top: 0.5rem;
    }
    #research .graph-caption {
      font-size: 0.78rem;
      text-align: center;
      line-height: 1.4;
      margin: 0.4rem 0 0;
      color: rgba(255,255,255,0.6);
    }

    /* ----- Footer ----- */
    footer {
      background: var(--bg-black);
      color: var(--text-on-dark);
      text-align: center;
      padding: 1.25rem;
      font-size: 0.85rem;
    }
  </style>
</head>
<body>
  <header class="hero" id="top">
    <img id="avatarImg" class="hero-photo" src="assets/me.jpg" alt="Tim Schubert" loading="eager"
         onerror="window.__avatarFallback && window.__avatarFallback(this)" />
    <p class="hero-typewriter" id="typewriter" aria-live="polite"></p>
    <nav class="hero-social" aria-label="Contact and profiles">
      <a href="mailto:tim.schubert.public@gmail.com" aria-label="Email">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 6h16v12H4z"/><path d="M22 7l-10 7L2 7"/></svg>
      </a>
      <a href="https://github.com/tim-schubert" target="_blank" rel="noopener" aria-label="GitHub">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 .5a11.5 11.5 0 0 0-3.64 22.41c.58.1.79-.25.79-.56v-2.1c-3.22.7-3.9-1.39-3.9-1.39-.53-1.35-1.3-1.7-1.3-1.7-1.06-.73.08-.72.08-.72 1.17.08 1.79 1.2 1.79 1.2 1.04 1.79 2.73 1.27 3.39.97.11-.76.41-1.27.75-1.56-2.57-.29-5.27-1.29-5.27-5.73 0-1.27.46-2.3 1.2-3.12-.12-.29-.52-1.46.11-3.05 0 0 .98-.31 3.2 1.19a11.1 11.1 0 0 1 5.82 0c2.22-1.5 3.2-1.19 3.2-1.19.63 1.59.24 2.76.12 3.05.75.82 1.2 1.85 1.2 3.12 0 4.45-2.71 5.44-5.29 5.72.42.36.8 1.07.8 2.16v3.2c0 .31.21.67.8.56A11.5 11.5 0 0 0 12 .5Z"/></svg>
      </a>
      <a href="https://linkedin.com/in/schubert-tim" target="_blank" rel="noopener" aria-label="LinkedIn">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M4.98 3.5C4.98 4.88 3.86 6 2.5 6S0 4.88 0 3.5 1.12 1 2.5 1s2.48 1.12 2.48 2.5zM.5 8h4V23h-4V8zm7.5 0h3.8v2.06h.05c.53-1 1.83-2.06 3.76-2.06 4.02 0 4.76 2.65 4.76 6.09V23h-4V15.2c0-1.86-.03-4.26-2.59-4.26-2.6 0-3 2.03-3 4.12V23h-4V8z"/></svg>
      </a>
      <a href="https://scholar.google.com/citations?hl=en&user=jDwhzckAAAAJ" target="_blank" rel="noopener" aria-label="Google Scholar">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 9l10-5 10 5-10 5-10-5z"/><path d="M6 12v5c0 .6 2.7 2 6 2s6-1.4 6-2v-5"/></svg>
      </a>
    </nav>
    <a href="#about" class="section-arrow hero-arrow" aria-label="Go to about">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>
    </a>
  </header>

  <section id="about" class="light">
    <div class="section-inner">
      <h2>About</h2>
      <div class="chips-float">
        <span class="chip">Neuroscience</span>
        <span class="chip">Genomics</span>
        <span class="chip">Machine Learning</span>
        <span class="chip">Computational Biology</span>
      </div>
      <p>I am deeply interested in people, life, and the world. My goal is to understand the brain and genes through science while making a positive impact in healthcare. I have research experience in neuroscience, genetics, machine learning, and computational biology across wet and dry lab techniques. My studies and research have brought me to many inspiring places with lovely people, including Heidelberg, Cambridge, Harvard, and MIT.</p>
      <p>Outside of academia, I enjoy meaningful conversations, making artisanal coffee, playing the piano, working out, skiing, surfing, sailing, and podcasting.</p>
      <p>Please reach out, I'm happy to connect!</p>
      <a class="btn-message" href="mailto:tim.schubert.public@gmail.com" aria-label="Send email">Send me a message</a>
    </div>
    <a href="#research" class="section-arrow" aria-label="Go to research" style="color: var(--text-light);">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>
    </a>
  </section>

  <section id="research" class="dark">
    <div class="section-inner">
      <h2>Research</h2>
      <p class="section-intro">I have diverse interests and love interdisciplinary work. Some recurring themes are:</p>
      <div class="themes">
        <div class="theme-item">
          <div class="theme-dot-wrap" aria-label="View research questions">
            <span class="theme-dot">?</span>
            <div class="theme-questions">
              <p>How can we link genetic variation to behavioral phenotypes?</p>
              <p>Which pathomechanisms underpin neurodevelopmental disorders?</p>
            </div>
          </div>
          <span class="theme-name">Neurodevelopment</span>
        </div>
        <div class="theme-item">
          <div class="theme-dot-wrap" aria-label="View research questions">
            <span class="theme-dot">?</span>
            <div class="theme-questions">
              <p>How can we integrate multi-modal data sources to understand and treat Alzheimer's disease (AD)?</p>
              <p>How can we model inter- and intra-individual disease heterogeneity?</p>
              <p>Can we find biomarkers of AD?</p>
            </div>
          </div>
          <span class="theme-name">Neurodegeneration</span>
        </div>
        <div class="theme-item">
          <div class="theme-dot-wrap" aria-label="View research questions">
            <span class="theme-dot">?</span>
            <div class="theme-questions">
              <p>How can we use cutting-edge machine learning for timely diagnoses?</p>
              <p>How do we individualize diagnostic and treatment pathways?</p>
              <p>How do we ensure best practice in predictive modeling?</p>
            </div>
          </div>
          <span class="theme-name">Individualized Medicine</span>
        </div>
      </div>
      <div class="graphCard">
        <svg id="graphsvg" viewBox="0 0 900 600" preserveAspectRatio="xMidYMid meet"></svg>
        <div id="paper-tooltip" class="paper-tooltip" role="tooltip" aria-hidden="true"></div>
      </div>
      <p class="graph-caption">Papers linked by topics. Hover for details. Click to open.</p>
      <div class="section-actions">
        <a href="https://scholar.google.com/citations?hl=en&user=jDwhzckAAAAJ" target="_blank" rel="noopener" aria-label="Google Scholar">
          <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 9l10-5 10 5-10 5L2 9z"/><path d="M6 12v5c0 .6 2.7 2 6 2s6-1.4 6-2v-5"/></svg>
          Google Scholar
        </a>
        <a href="https://www.researchgate.net/profile/Tim-Schubert-11" target="_blank" rel="noopener" aria-label="ResearchGate">
          <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/></svg>
          ResearchGate
        </a>
      </div>
    </div>
    <a href="#now" class="section-arrow" aria-label="Go to projects">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>
    </a>
  </section>

  <section id="now" class="light">
    <div class="section-inner">
      <h2>Currently working on</h2>
      <ul>
        <li class="item"><b>Genetic variation influencing neurodevelopment and behavior</b> in Schaaf-Yang syndrome, an ultra-rare condition.</li>
        <li class="item"><b>AI co-pilots for clinician scientists</b> that bring predictive modeling best practice to anyone's fingertips.</li>
        <li class="item"><b>Cell-projected phenotypes</b> linking transcriptional and clinical heterogeneity in Alzheimer's disease.</li>
        <li class="item"><b>Becoming a clinician scientist</b> in human genetics or neurology.</li>
        <li class="item"><b>SITUS INVERSUS</b>, peer-teaching for medical students in podcast format.</li>
        <li class="item"><b>Building a think-tank for reality-centric clinical AI</b> with the van der Schaar Lab.</li>
        <li class="item"><b>Linear Algebra and philosophy</b> classes.</li>
        <li class="item"><b>Learning how to sail</b> on the Charles River.</li>
      </ul>
      <div class="floating-buttons" aria-label="Projects and links">
        <a href="https://tim-schubert-mfap.share.connect.posit.cloud/" target="_blank" rel="noopener" aria-label="MfAP — Molecular feature Association Pipeline">
          <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6l6-3 6 3 6-3v15l-6 3-6-3-6 3V6z"/><path d="M9 3v15M15 6v15"/></svg>
          MfAP
        </a>
        <a href="https://timschubert.shinyapps.io/SYS-Severity-Score-Calculator/" target="_blank" rel="noopener" aria-label="SYS Severity Score Calculator">
          <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="4" y="2" width="16" height="20" rx="2"/><path d="M7 7h10M7 12h10M7 17h4M13 17h4"/></svg>
          SYS Severity Score
        </a>
        <a href="https://github.com/vanderschaarlab/climb" target="_blank" rel="noopener" aria-label="CliMB — Predictive Modeling Partner">
          <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 20l7-12 4 6 3-4 4 10H3z"/><path d="M10 8l2 3"/></svg>
          CliMB
        </a>
        <a href="https://dervorklinikpodcast.de/" target="_blank" rel="noopener" aria-label="Situs Inversus — Der Vorklinik-Podcast">
          <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="2"/><path d="M8 12a4 4 0 0 1 8 0"/><path d="M5 12a7 7 0 0 1 14 0"/><path d="M12 14v6"/><path d="M9 20h6"/></svg>
          Situs Inversus Podcast
        </a>
      </div>
    </div>
    <a href="#top" class="section-arrow" aria-label="Back to top">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 19V5M5 12l7-7 7 7"/></svg>
    </a>
  </section>

  <footer>©<span id="y"></span> Tim Schubert</footer>

  <script>
    document.getElementById('y').textContent = new Date().getFullYear();

    // Typewriter + hero arrow bounce
    (function(){
      const el = document.getElementById('typewriter');
      const heroArrow = document.querySelector('.hero-arrow');
      const text = "Hey! I'm Tim, an MD/PhD Student who is fascinated by brains, genes, and data.";
      let i = 0;
      const speed = 45;
      function type() {
        if (i < text.length) {
          el.innerHTML = text.slice(0, i + 1) + '<span class="cursor" aria-hidden="true"></span>';
          i++;
          setTimeout(type, speed);
        } else {
          el.innerHTML = text + '<span class="cursor" aria-hidden="true"></span>';
          if (heroArrow) setTimeout(() => {
            heroArrow.classList.add('arrow-bounce');
            heroArrow.addEventListener('animationend', () => heroArrow.classList.remove('arrow-bounce'), { once: true });
          }, 2000);
        }
      }
      type();
    })();

    // Theme question bubbles: flip below on desktop when they would overflow the top
    (function(){
      const BUBBLE_H = 260;
      const PAD = 16;
      const isMobile = () => window.innerWidth <= 768;
      document.querySelectorAll('.theme-dot-wrap').forEach(wrap => {
        const bubble = wrap.querySelector('.theme-questions');
        if (!bubble) return;
        wrap.addEventListener('mouseenter', () => {
          if (isMobile()) return;
          const r = wrap.getBoundingClientRect();
          bubble.classList.toggle('flip-below', r.top < BUBBLE_H + PAD);
        });
      });
    })();

    // Research graph: unified blue palette (matches 1.–3. topic cards)
    const themeColor = {
      neurodev: getComputedStyle(document.documentElement).getPropertyValue('--theme-1').trim(),
      neurodeg: getComputedStyle(document.documentElement).getPropertyValue('--theme-2').trim(),
      mlmed: getComputedStyle(document.documentElement).getPropertyValue('--theme-3').trim()
    };
    const graphEdgeColor = getComputedStyle(document.documentElement).getPropertyValue('--graph-edge').trim() || 'rgba(148,163,184,0.5)';

    async function loadFromCSV(){
      const SHEET_ID = '1-8lNuUl9Fctp99U6mb2JrDR9Ct8Amf6TgmkyxhrJdRw';
      const SHEET_NAME = 'papers-for-website';
      const urls = [
        `https://docs.google.com/spreadsheets/d/${SHEET_ID}/pub?output=csv`,
        `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(SHEET_NAME)}`,
        `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=0`
      ];
      let lastErr = null;
      for(const url of urls){
        try{
          const rows = await d3.csv(url);
          if(rows && rows.length){
            const themes = {};
            rows.forEach(r => {
              const id = (r.theme||'').trim();
              if(!id) return;
              themes[id] = themes[id] || { id, color: themeColor[id]||'#888', papers: [] };
              const tags = (r.tags||'').split(';').map(s=>s.trim()).filter(Boolean);
              themes[id].papers.push({ title: r.title?.trim(), url: r.url?.trim(), tags });
            });
            return { themes: Object.values(themes), source:url };
          }
        }catch(e){ lastErr = e; }
      }
      const svgEl = document.getElementById('graphsvg');
      if(svgEl){
        const warn = document.createElement('div');
        warn.style.cssText = 'position:absolute;inset:12px;border:2px dashed #ccc;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:14px;color:#737373;background:rgba(255,255,255,0.8);';
        warn.textContent = 'Could not load research data. Check Google Sheets sharing.';
        const holder = document.querySelector('#research .graphCard');
        if(holder) holder.appendChild(warn);
      }
      return { themes: [], error:lastErr };
    }

    const themeLabels = { neurodev: 'Neurodevelopment', neurodeg: 'Neurodegeneration', mlmed: 'Individualized Medicine' };

    (async () => {
      const RESEARCH = await loadFromCSV();
      const nodesData = [];
      RESEARCH.themes.forEach(theme => {
        theme.papers.forEach((p,idx)=> nodesData.push({ id: `${theme.id}_${idx}`, theme: theme.id, color: theme.color, title: p.title, url: p.url, tags: p.tags||[] }));
      });
      const linksData = [];
      for(let i=0;i<nodesData.length;i++){
        for(let j=i+1;j<nodesData.length;j++){
          const a = nodesData[i], b = nodesData[j];
          const overlap = a.tags.filter(t => b.tags.includes(t));
          if(overlap.length){ linksData.push({ source:a.id, target:b.id, weight: overlap.length }); }
        }
      }
      const degree = Object.fromEntries(nodesData.map(n=>[n.id,0]));
      linksData.forEach(e=>{ degree[e.source]++; degree[e.target]++; });

      const width = 900, height = 600;
      const centerX = width / 2, centerY = height / 2;
      const themeX = { neurodev: centerX - 180, neurodeg: centerX, mlmed: centerX + 180 };
      // Start nodes collapsed at theme columns so they expand when section comes into view
      nodesData.forEach(n => { n.x = themeX[n.theme] || centerX; n.y = centerY; });

      const svg = d3.select('#graphsvg');
      const defs = svg.append('defs');
      defs.append('filter').attr('id', 'node-shadow').attr('x', '-40%').attr('y', '-40%').attr('width', '180%').attr('height', '180%')
        .append('feDropShadow').attr('dx', 0).attr('dy', 1).attr('stdDeviation', 3).attr('flood-color', '#fff').attr('flood-opacity', 0.12);
      const g = svg.append('g').attr('transform', 'translate(450,300) scale(1.2) translate(-450,-300)');
      const hullG = g.append('g').attr('class', 'hulls');
      const linkG = g.append('g').attr('class', 'links');
      const nodeG = g.append('g').attr('class', 'nodes');
      const tooltipEl = document.getElementById('paper-tooltip');
      let isDragging = false;
      let dragStart = null;

      const isMobile = () => window.matchMedia('(hover: none), (pointer: coarse)').matches || window.innerWidth <= 820;
      function showTooltip(event, d) {
        const label = themeLabels[d.theme] || d.theme;
        const title = (d.title || 'Paper').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        tooltipEl.innerHTML = '<div class="tooltip-theme">' + label + '</div><div class="tooltip-title">' + title + '</div><div class="tooltip-hint">' + (isMobile() ? 'Tap to open' : 'Click to open') + '</div>';
        tooltipEl.style.display = 'block';
        tooltipEl.style.pointerEvents = 'auto';
        tooltipEl.dataset.url = d.url || '';
        if (isMobile()) {
          tooltipEl.style.left = '50%';
          tooltipEl.style.top = '50%';
          tooltipEl.style.transform = 'translate(-50%, -50%)';
          tooltipEl.style.minWidth = 'min(320px, calc(100vw - 2rem))';
        } else {
          tooltipEl.style.transform = '';
          tooltipEl.style.minWidth = '';
          tooltipEl.style.left = (event.clientX + 16) + 'px';
          tooltipEl.style.top = (event.clientY + 12) + 'px';
          const r = tooltipEl.getBoundingClientRect();
          if (r.right > window.innerWidth) tooltipEl.style.left = (event.clientX - r.width - 8) + 'px';
          if (r.bottom > window.innerHeight) tooltipEl.style.top = (event.clientY - r.height - 8) + 'px';
        }
      }
      function moveTooltip(event) {
        tooltipEl.style.left = (event.clientX + 16) + 'px';
        tooltipEl.style.top = (event.clientY + 12) + 'px';
        const r = tooltipEl.getBoundingClientRect();
        if (r.right > window.innerWidth) tooltipEl.style.left = (event.clientX - r.width - 8) + 'px';
        if (r.bottom > window.innerHeight) tooltipEl.style.top = (event.clientY - r.height - 8) + 'px';
      }
      let hideTooltipTimer = null;
      function hideTooltip(delay = 0) {
        if (delay) {
          clearTimeout(hideTooltipTimer);
          hideTooltipTimer = setTimeout(() => {
            tooltipEl.style.display = 'none';
            tooltipEl.style.pointerEvents = 'none';
            tooltipEl.innerHTML = '';
          }, delay);
        } else {
          clearTimeout(hideTooltipTimer);
          tooltipEl.style.display = 'none';
          tooltipEl.style.pointerEvents = 'none';
          tooltipEl.innerHTML = '';
        }
      }
      tooltipEl.addEventListener('click', (e) => {
        e.stopPropagation();
        const url = tooltipEl.dataset.url;
        if (url) {
          window.open(url, '_blank');
          hideTooltip();
          if (typeof window.__armedNode !== 'undefined') window.__armedNode = null;
          nodes.attr('opacity', 1).attr('stroke-width', 2);
          links.attr('stroke-opacity', 0.35);
        }
      });
      tooltipEl.addEventListener('mouseenter', () => clearTimeout(hideTooltipTimer));
      tooltipEl.addEventListener('mouseleave', () => hideTooltip(150));

      const sim = d3.forceSimulation(nodesData)
        .force('link', d3.forceLink(linksData).id(d=>d.id).distance(100).strength(0.3))
        .force('charge', d3.forceManyBody().strength(-80))
        .force('x', d3.forceX(d=> themeX[d.theme] || centerX).strength(0.08))
        .force('y', d3.forceY(centerY).strength(0.04))
        .force('collision', d3.forceCollide().radius(d=> 18 + 4*Math.sqrt(degree[d.id]||0)).strength(0.8))
        .alphaTarget(0).alpha(0);  // Paused until research section is in view

      const researchEl = document.getElementById('research');
      if (researchEl) {
        const io = new IntersectionObserver((entries) => {
          if (!entries[0].isIntersecting) return;
          sim.alpha(0.5).alphaTarget(0.03).restart();
          io.disconnect();
        }, { threshold: 0.25 });
        io.observe(researchEl);
      } else {
        sim.alpha(0.5).alphaTarget(0.03).restart();
      }

      function linkPath(d) {
        const sx = d.source.x, sy = d.source.y, tx = d.target.x, ty = d.target.y;
        const mx = (sx + tx) / 2, my = (sy + ty) / 2;
        const qx = mx + (ty - sy) * 0.15;
        const qy = my - (tx - sx) * 0.15;
        return 'M' + sx + ',' + sy + 'Q' + qx + ',' + qy + ' ' + tx + ',' + ty;
      }

      const links = linkG.selectAll('path').data(linksData).enter().append('path')
        .attr('d', linkPath)
        .attr('fill', 'none')
        .attr('stroke', graphEdgeColor)
        .attr('stroke-opacity', 0.35)
        .attr('stroke-width', d=> 0.8 + Math.min(1.5, (d.weight||1) * 0.4))
        .attr('stroke-linecap', 'round');

      function drawHulls() {
        hullG.selectAll('path').remove();
        ['neurodev', 'neurodeg', 'mlmed'].forEach(themeId => {
          const pts = nodesData.filter(n => n.theme === themeId).map(n => [n.x, n.y]);
          if (pts.length < 3) return;
          const hull = d3.polygonHull(pts);
          if (!hull) return;
          const color = themeColor[themeId] || '#94a3b8';
          hullG.append('path')
            .attr('d', 'M' + hull.join('L') + 'Z')
            .attr('fill', color)
            .attr('fill-opacity', 0.12)
            .attr('stroke', color)
            .attr('stroke-opacity', 0.22)
            .attr('stroke-width', 1);
        });
      }

      const pad = 35;  // Minimum margin from edges (keeps nodes fully visible)
      const svgEl = svg.node();
      function toSvgCoords(clientX, clientY) {
        const pt = svgEl.createSVGPoint();
        pt.x = clientX;
        pt.y = clientY;
        return pt.matrixTransform(svgEl.getScreenCTM().inverse());
      }
      function drag(sim){
        function dragstarted(event, d){ isDragging = true; dragStart = { x: event.x, y: event.y }; hideTooltip(); hullG.attr('opacity', 0); if(!event.active) sim.alphaTarget(0.15).restart(); d.fx = d.x; d.fy = d.y; }
        function dragged(event, d){
          const pt = toSvgCoords(event.sourceEvent.clientX, event.sourceEvent.clientY);
          d.fx = Math.max(pad, Math.min(width - pad, pt.x));
          d.fy = Math.max(pad, Math.min(height - pad, pt.y));
        }
        function dragended(event, d){
          isDragging = false;
          const dist = dragStart ? Math.hypot(event.x - dragStart.x, event.y - dragStart.y) : 0;
          dragStart = null;
          hullG.attr('opacity', 1);
          if(!event.active) sim.alphaTarget(0);
          d.fx = null; d.fy = null;
          if (dist < 8 && d.url) window.open(d.url, '_blank');
        }
        return d3.drag().on('start', dragstarted).on('drag', dragged).on('end', dragended);
      }

      const nodes = nodeG.selectAll('circle').data(nodesData).enter().append('circle')
        .attr('cx', d=> d.x)
        .attr('cy', d=> d.y)
        .attr('r', d=> 10 + 3*Math.sqrt(degree[d.id]||0))
        .attr('fill', d=> d.color)
        .attr('stroke', 'rgba(255,255,255,0.4)')
        .attr('stroke-width', 1.5)
        .attr('filter', 'url(#node-shadow)')
        .style('cursor', 'pointer')
        .on('mouseover', (event, d)=>{
          if (isDragging) return;
          showTooltip(event, d);
          const neigh = new Set([d.id]);
          linksData.forEach(e=>{ if(e.source.id===d.id) neigh.add(e.target.id); if(e.target.id===d.id) neigh.add(e.source.id); });
          nodes.attr('opacity', n=> neigh.has(n.id)? 1 : 0.25).attr('stroke-width', n=> neigh.has(n.id)? 2 : 0.5);
          links.attr('stroke-opacity', e=> (e.source.id===d.id || e.target.id===d.id)? 0.7 : 0.12);
        })
        .on('mousemove', (event)=>{ if (!isDragging) moveTooltip(event); })
        .on('mouseout', ()=>{
          hideTooltip(150);
          nodes.attr('opacity', 1).attr('stroke-width', 2);
          links.attr('stroke-opacity', 0.35);
        })
        .on('click', (event, d)=>{
          const isMobile = window.matchMedia('(hover: none), (pointer: coarse)').matches || window.innerWidth <= 820;
          if(!isMobile){ if(d.url) window.open(d.url, '_blank'); return; }
          window.__armedNode = window.__armedNode || null;
          if(window.__armedNode === d.id){ window.__armedNode = null; hideTooltip(); if(d.url) window.open(d.url, '_blank'); return; }
          window.__armedNode = d.id;
          showTooltip(event, d);
          const neigh = new Set([d.id]);
          linksData.forEach(e=>{ if(e.source.id===d.id) neigh.add(e.target.id); if(e.target.id===d.id) neigh.add(e.source.id); });
          nodes.attr('opacity', n=> neigh.has(n.id)? 1 : 0.25).attr('stroke-width', n=> neigh.has(n.id)? 2 : 0.5);
          links.attr('stroke-opacity', e=> (e.source.id===d.id || e.target.id===d.id)? 0.7 : 0.12);
          event.stopPropagation();
        })
        .call(drag(sim));

      svg.on('click', (event)=>{
        const isMobile = window.matchMedia('(hover: none), (pointer: coarse)').matches || window.innerWidth <= 820;
        if(!isMobile) return;
        if(event.target.tagName.toLowerCase() === 'circle') return;
        window.__armedNode = null;
        hideTooltip();
        nodes.attr('opacity', 1).attr('stroke-width', 2);
        links.attr('stroke-opacity', 0.35);
      });
      window.addEventListener('resize', ()=>{ hideTooltip(); window.__armedNode = null; nodes.attr('opacity', 1).attr('stroke-width', 2); links.attr('stroke-opacity', 0.35); });

      sim.on('tick', ()=>{
        links.attr('d', linkPath);
        nodes.attr('cx', d=>d.x).attr('cy', d=>d.y);
        if (!isDragging) drawHulls();
      });
    })();
  </script>

  <script>
    (function(){
      const CANDIDATES = ['assets/me.jpg','assets/me.JPG','assets/Me.jpg','assets/ME.jpg','assets/me.jpeg','assets/me.PNG','assets/me.png'];
      window.__avatarFallback = function(img){
        const tried = img.getAttribute('data-tried') ? img.getAttribute('data-tried').split('|') : [];
        const next = CANDIDATES.find(u => !tried.includes(u));
        if(next){ tried.push(next); img.setAttribute('data-tried', tried.join('|')); img.src = next; return; }
        const svg = `<svg xmlns="http://www.w3.org/2000/svg" width="512" height="512"><rect width="100%" height="100%" fill="#333"/><circle cx="256" cy="256" r="240" fill="#444" stroke="#e5e5e5" stroke-width="8"/><text x="50%" y="54%" text-anchor="middle" font-family="Rubik,sans-serif" font-size="180" font-weight="700" fill="#e5e5e5">TS</text></svg>`;
        img.src = 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(svg);
      };
    })();
  </script>
</body>
</html>

